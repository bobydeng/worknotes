int timer = 100;    
int U18 = A1;
int State = 0;
int lastState = 0;
int pin1 = 5;
int pin9 = 13;
int pin10 = A0;
boolean startFrame = false;
//int m;

const int data[][360] /*PROGMEM*/ = {
{256,256,256,256,256,256,256,256,256,256,
256,260,260,260,260,4,0,0,8,8,
136,136,144,240,112,96,96,0,0,0,
16,16,48,48,48,96,96,64,64,64,
64,64,64,64,64,64,0,0,2,2,
2,2,66,66,66,66,66,322,322,356,
356,356,308,316,316,312,312,272,384,128,
128,128,128,128,192,192,192,192,192,224,
224,224,176,176,176,144,152,152,144,144,
176,176,176,224,224,224,224,192,192,192,
128,128,384,384,384,256,256,256,264,264,
280,280,24,56,48,48,96,96,96,96,
224,224,208,208,144,402,402,402,406,150,
12,12,12,12,8,8,8,8,24,16,
16,16,16,16,16,48,48,32,32,0,
0,0,0,0,0,0,0,32,96,112,
112,216,136,136,136,128,132,132,4,4,
0,0,0,0,0,0,0,2,258,258,
258,258,256,0,0,0,0,0,4,4,
4,132,128,128,136,136,216,112,112,112,
32,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,96,
96,32,32,32,32,32,48,48,16,16,
16,24,56,56,120,252,252,244,470,470,
402,400,272,272,272,272,0,8,8,8,
8,8,8,8,8,8,8,0,256,256,
384,448,480,496,504,504,504,120,72,72,
72,72,72,72,72,72,72,72,72,72,
72,328,328,328,328,320,320,320,256,256,
256,260,260,268,268,284,284,284,48,48,
50,34,98,98,98,66,66,66,194,194,
130,130,130,130,66,66,70,70,68,68,
108,108,56,56,56,24,16,0,0,0,
0,0,0,0,0,0,0,0,0,0,
96,96,112,240,144,136,136,136,0,0,
256,260,260,260,260,256,256,256,256,256},

{0,0,128,240,240,224,224,240,144,144,
128,128,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,16,16,16,48,
48,48,48,96,96,96,232,232,248,248,
208,208,208,116,124,124,124,362,362,366,
366,430,446,438,439,439,919,733,732,732,
734,254,126,126,114,112,244,252,252,508,
508,492,492,932,420,308,312,312,312,312,
56,40,40,40,8,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,16,16,16,16,
16,16,16,16,16,16,16,16,26,26,
282,270,270,270,270,412,508,508,508,508,
508,508,510,510,222,18,18,19,19,16,
16,16,16,16,16,16,16,16,16,16,
24,24,24,24,24,8,8,8,0,0,
0,0,0,0,0,0,0,32,96,96,
96,96,64,192,240,240,144,128,128,224,
224,128,128,128,128,224,224,192,16,48,
112,224,192,128,128,0,0,0,0,0,
0,0,0,0,0,0,16,56,56,48,
48,48,48,52,28,28,24,24,152,152,
152,156,158,190,158,142,143,140,430,942,
942,938,931,803,289,417,425,428,424,424,
488,200,200,216,248,240,112,112,112,56,
56,28,60,60,44,36,32,0,0,0,
0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,
8,8,40,32,44,44,56,312,312,312,
376,368,372,484,484,484,484,484,484,420,
420,420,412,956,958,958,959,959,951,949,
917,532,148,212,212,220,92,124,124,124,
124,108,96,32,48,48,112,112,120,88,
88,80,64,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,16,64,64,
64,0,0,0,32,96,112,112,0,0}/*,

{192,192,64,64,64,0,0,0,0,0,
0,0,24,24,28,28,60,60,62,62,
62,62,62,62,62,62,62,62,62,62,
62,62,62,62,30,30,30,28,28,12,
12,0,0,0,0,0,0,0,0,0,
0,0,0,0,128,128,128,384,384,384,
384,384,384,384,384,384,384,384,384,128,
128,0,0,8,8,8,24,24,24,24,
8,8,8,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,32,
32,112,112,112,112,112,112,112,112,120,
120,120,120,112,112,112,112,112,112,112,
112,48,32,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,24,24,
24,24,24,24,24,24,24,24,24,24,
24,0,0,0,0,0,0,0,0,0,
0,0,16,24,56,56,56,60,60,60,
60,60,124,124,124,124,124,124,124,124,
124,124,60,60,60,60,60,56,56,56,
24,16,0,0,0,128,128,128,128,128,
128,128,128,128,128,128,128,0,0,8,
12,12,12,12,12,12,12,12,12,12,
12,8,0,0,0,0,0,0,64,96,
96,96,96,96,96,96,96,96,96,96,
96,96,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,
0,48,112,112,120,120,120,120,124,252,
252,252,252,252,252,252,252,252,252,252,
254,252,252,252,252,252,252,252,252,252,
252,252,124,124,124,120,120,120,112,48,
0,0,0,0,0,0,0,0,0,8,
8,28,28,28,28,28,28,28,28,28,
28,28,88,88,88,64,64,96,96,96,
96,96,96,64,64,66,70,6,6,14,
15,15,15,15,79,79,78,198,198,198,
230,224,224,224,224,224,224,224,224,192}*/
};

void setup() {
  for (int Pin = pin1; Pin <=pin9; Pin++) {
    pinMode(Pin, OUTPUT);
  }
  pinMode(pin10, OUTPUT);
  pinMode(U18, INPUT);
}

int i =0,j=0, k=0;
void loop() {
  if (startFrame) {
    startFrame = false;
    for(int j=0;j<360;j++){
      //WriteLetter1Width(pgm_read_word(&data[i][j]));
      WriteLetter1Width(data[i][j]);
      checkHome();
      if(startFrame) {
        break;  //stop current frame
      }
    }
    WriteLetter1Width(0);
    k++;
    if(k >= 200) {
      k = 0;
      i++;
      i%=1;
    }
  } else {
    checkHome();
  }

}

inline void checkHome() {
  State = digitalRead(U18);
  if (State != lastState && State == LOW){
    startFrame = true;
  }
  lastState = State;
}

/*
inline void WriteLetter1Width(int leds){
  m=0;
  for (int Pin = pin1; Pin <=pin9; Pin++) {
    if (leds & (1 << m)) {
      digitalWrite(Pin, HIGH);
    }else {
      digitalWrite(Pin, LOW);
    }
    m=m+1;
  }

  if (leds & (1 << m)) {
    digitalWrite(pin10, HIGH);
  }else {
    digitalWrite(pin10, LOW);
  }
  
  //delayMicroseconds(timer);
}
*/


inline void WriteLetter1Width(int leds){
  PORTD = leds << 5;  //0 ~ 2 -> D5 ~ D7
  PORTB = leds >> 3;  //3 ~ 8 -> B0 ~ B5
  PORTC = leds >> 9;  //    9 ->      CÔºê
  delayMicroseconds(timer);
}

